
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Support — Peripheral Hub</title>
  <style>
    :root{
      --bg:#071226; --panel:#0b1220; --muted:#9aa4b2; --accent:#08a0ff; --text:#e6eef6; --radius:10px; --glass:rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071226,#061425);color:var(--text);font-family:Inter,system-ui,Arial;padding:0}
    header{padding:14px 18px;background:linear-gradient(90deg,rgba(8,160,255,0.04),transparent);border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#6ef0ff);display:flex;align-items:center;justify-content:center;color:#04202b;font-weight:800;text-decoration: none;}
    main{max-width:900px;margin:20px auto;padding:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px;border:1px solid rgba(255,255,255,0.03);padding:16px;margin-bottom:14px}
    form .row{display:flex;gap:10px;flex-wrap:wrap}
    input[type="text"], input[type="email"], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid var(--glass);background:transparent;color:var(--text)}
    textarea{min-height:120px}
    .btn{padding:10px 14px;border-radius:8px;border:none;background:var(--accent);color:#04202b;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}
    .muted{color:var(--muted)}
    .small{font-size:0.9rem}
    .faq{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .faq-item{border:1px solid rgba(255,255,255,0.03);border-radius:8px;padding:12px;background:var(--panel)}
    .faq-item summary{cursor:pointer;font-weight:700}
    footer{text-align:center;padding:18px;color:var(--muted);margin-top:20px;border-top:1px solid rgba(255,255,255,0.03)}
    @media(max-width:600px){ main{padding:12px} form .row{flex-direction:column} }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"><a href="userindex.html" class="logo">PH</a></div>
      <div>
        <div style="font-weight:800">Peripheral Hub</div>
        <div style="font-size:0.9rem;color:var(--muted)">Support & Help</div>
      </div>
    </div>
    <nav>
      <a href="userindex.html" style="color:var(--muted);margin-right:12px">Shop</a>
      <a href="myorders.html" style="color:var(--muted);margin-right:12px">My Orders</a>
      <a href="support.html" style="color:var(--accent)">Support</a>
    </nav>
  </header>

  <main>
    <div class="card">
      <h2 style="margin:0 0 8px">Ask a question</h2>
      <p class="muted small" style="margin:0 0 12px">Fill the form below and our support team will get back to you.</p>

      <form id="support-form">
        <div class="row">
          <div style="flex:1">
            <label class="muted small">Your name</label>
            <input id="u-name" type="text" required />
          </div>
          <div style="width:260px">
            <label class="muted small">Email</label>
            <input id="u-email" type="email" required />
          </div>
        </div>

        <div style="margin-top:10px">
          <label class="muted small">Subject</label>
          <input id="u-subject" type="text" required />
        </div>

        <div style="margin-top:10px">
          <label class="muted small">Category</label>
          <select id="u-category">
            <option value="Order">Order</option>
            <option value="Product">Product</option>
            <option value="Shipping">Shipping</option>
            <option value="Returns">Returns</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div style="margin-top:10px">
          <label class="muted small">Message</label>
          <textarea id="u-message" required></textarea>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <button class="btn" type="submit">Send question</button>
          <button class="btn ghost" id="clear-form" type="button">Clear</button>
          <div id="submit-msg" class="muted small" style="margin-left:auto"></div>
        </div>
      </form>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Common questions</h3>
      <div class="muted small">Answers to frequently asked questions</div>

      <div class="faq">
        <details class="faq-item" open><summary>How do I track my order?</summary><div class="muted small" style="margin-top:8px">Open My Orders page and click Track on your order. If you need help, contact support.</div></details>

        <details class="faq-item"><summary>What is your return policy?</summary><div class="muted small" style="margin-top:8px">30-day returns on most products. Items must be in original condition. See Returns page for details.</div></details>

        <details class="faq-item"><summary>When will I receive my refund?</summary><div class="muted small" style="margin-top:8px">Refunds are processed within 5–7 business days after we receive the returned item.</div></details>

        <details class="faq-item"><summary>Do you provide warranty?</summary><div class="muted small" style="margin-top:8px">Many products include manufacturer warranty. Check product page or contact support for warranty claims.</div></details>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Your recent requests</h3>
      <div id="your-requests" class="muted small">Loading…</div>
    </div>
  </main>

  <footer>&copy; 2025 Peripheral Hub — Support</footer>

  <script>
    // store in same queue used by admin
    const STORAGE_KEY = 'ph_support_queries_v1';

    function loadQueue(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch(e){
        console.error('Failed to parse support queue', e);
        return [];
      }
    }
    function saveQueue(q){ try { localStorage.setItem(STORAGE_KEY, JSON.stringify(q)); } catch(e){ console.error(e); } }

    // form
    const form = document.getElementById('support-form');
    const msgEl = document.getElementById('submit-msg');
    const yourRequests = document.getElementById('your-requests');
    const clearBtn = document.getElementById('clear-form');

    function uid(){ return 'TCK-' + Math.random().toString(36).slice(2,9).toUpperCase(); }

    function renderUserRequests(email){
      const all = loadQueue();
      const mine = email ? all.filter(r => (r.email||'').toLowerCase() === email.toLowerCase()) : all.slice(0,8);
      if (!mine.length) { yourRequests.innerHTML = '<div class="muted small">No recent requests</div>'; return; }
      yourRequests.innerHTML = mine.map(r=>`
        <div style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;gap:12px">
          <div>
            <div style="font-weight:700">${escapeHtml(r.subject)} <span class="muted small">(${escapeHtml(r.category)})</span></div>
            <div class="muted small">${new Date(r.date).toLocaleString()}</div>
          </div>
          <div style="align-self:center"><span style="padding:6px 8px;border-radius:6px;background:${r.status==='resolved'?'#18b486':'rgba(8,160,255,0.1)'};color:${r.status==='resolved'?'#04202b':'var(--accent)'}">${escapeHtml(r.status)}</span></div>
        </div>
      `).join('');
    }

    function escapeHtml(s=''){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    if (form && yourRequests && msgEl) {
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const nameEl = document.getElementById('u-name');
        const emailEl = document.getElementById('u-email');
        const subjectEl = document.getElementById('u-subject');
        const categoryEl = document.getElementById('u-category');
        const messageEl = document.getElementById('u-message');

        const name = nameEl ? nameEl.value.trim() : '';
        const email = emailEl ? emailEl.value.trim() : '';
        const subject = subjectEl ? subjectEl.value.trim() : '';
        const category = categoryEl ? categoryEl.value : 'Other';
        const message = messageEl ? messageEl.value.trim() : '';
        if (!name || !email || !subject || !message) { msgEl.textContent = 'Please fill required fields'; return; }

        const q = loadQueue();
        const ticket = { id: uid(), name, email, subject, category, message, date: Date.now(), status: 'open', replies: [] };
        q.unshift(ticket);
        saveQueue(q);

        msgEl.textContent = 'Question submitted — support will contact you.';
        setTimeout(()=> msgEl.textContent = '', 3000);

        // keep user's requests shown
        renderUserRequests(email);

        // clear message fields
        if (subjectEl) subjectEl.value = '';
        if (messageEl) messageEl.value = '';
      });

      if (clearBtn) {
        clearBtn.addEventListener('click', (e)=>{ e.preventDefault(); form.reset(); msgEl.textContent=''; });
      }

      // initialize: show last 8 requests
      renderUserRequests();
    } else {
      console.warn('Support page DOM not fully loaded');
    }

    // small helper to expose for debugging
    window._phSupportClient = { loadQueue, saveQueue, renderUserRequests };
  </script>
</body>
</html>
